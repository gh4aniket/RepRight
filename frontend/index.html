<!DOCTYPE html>
<html>
<head>
  <title>Exercise Posture Detection</title>

  <style>
    /* Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      text-align: center;
      color: white;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    /* ðŸ”¥ Background image */
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url("https://images.unsplash.com/photo-1599058917212-d750089bc07e?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8d29ya291dHxlbnwwfHwwfHx8MA%3D%3D");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      z-index: -2;
    }

    /* ðŸŒ‘ Dark overlay for readability */
    body::after {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.65);
      z-index: -1;
    }

    h2 {
      margin-top: 30px;
      font-size: 32px;
      letter-spacing: 1px;
    }

    button {
      padding: 12px 24px;
      margin: 15px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 6px;
      border: none;
      background: #ff4757;
      color: white;
      transition: transform 0.2s, background 0.2s;
    }

     button {
      padding: 12px 24px;
      margin: 15px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 6px;
      border: none;
      background: #ff4757;
      color: white;
      transition: transform 0.2s, background 0.2s;
    }

    .button {
      padding: 12px 24px;
      margin: 15px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 6px;
      border: none;
      background: #ff4757;
      color: white;
      transition: transform 0.2s, background 0.2s;
    }

    button:hover {
      background: #ff6b81;
      transform: scale(1.05);
    }

    img {
      margin-top: 25px;
      border-radius: 12px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
      background: black;
    }

    video {
      display: none; /* hidden raw camera feed */
    }
     .vox-heading {
  font-size: 3.2rem;          /* BIG and bold */
  font-weight: 800;
  letter-spacing: 0.25em;     /* modern, spaced look */
  color: #ffffff;
  text-transform: uppercase;
  line-height: 1;
  text-shadow:
    0 2px 8px rgba(0, 0, 0, 0.6),
    0 0 20px rgba(255, 0, 0, 0.25); /* subtle glow */
}
  </style>
</head>

<body>
  <h1 class="vox-heading">RepRight</h1>
  <h2 >Select Exercise</h2>

  <button onclick="startStream('push')">Push-ups</button>
  <button onclick="startStream('squats')">Squats</button>
  <button onclick="startStream('lunges')">Lunges</button>
  <button onclick="startStream('lunges')">Deadlift</button>

<select id="exercise" name="exercise" class="button">
  <option value="">-- More exercises --</option>

  <optgroup label="More Exercises">
    <option value="squats">Squats</option>
    <option value="lunges">Lunges</option>
    <option value="pushups">Push Ups</option>
    <option value="plank">Plank</option>
    <option value="deadlift">Deadlift</option>
    <option value="bench_press">Bench Press</option>
    <option value="shoulder_press">Shoulder Press</option>
    <option value="bicep_curls">Bicep Curls</option>
  </optgroup>
</select>


  <br />

  <!-- Hidden camera feed -->
  <video id="camera" autoplay playsinline></video>

  <!-- Output from backend -->
  <img id="video" width="800" height="480"/>

  <!-- Hidden canvas -->
  <canvas id="canvas" width="800" height="480" style="display:none;"></canvas>

  <!-- Your existing JS stays exactly the same -->
</body>
  <script>
    let ws = null;
    let stream = null;
    let sendInterval = null;

    const img = document.getElementById("video");
    const video = document.getElementById("camera");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    async function startCamera() {
      if (stream) return;

      stream = await navigator.mediaDevices.getUserMedia({
        video: { width: 800, height: 480 },
        audio: false
      });

      video.srcObject = stream;
    }

    function startStream(exercise) {
      // Close previous WebSocket
      if (ws) {
        ws.close();
        ws = null;
      }

      // Stop previous frame sending
      if (sendInterval) {
        clearInterval(sendInterval);
        sendInterval = null;
      }

      startCamera().then(() => {
        const url = `wss://repright-5m3y.onrender.com:8000/${exercise}`;
        ws = new WebSocket(url);

        ws.onopen = () => {
          console.log("Connected to", url);

          // Send frames at ~20 FPS
          sendInterval = setInterval(() => {
            if (ws.readyState !== WebSocket.OPEN) return;

            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const dataURL = canvas.toDataURL("image/jpeg", 0.7);
            const base64Frame = dataURL.split(",")[1];

            ws.send(base64Frame);
          }, 50);
        };

        ws.onmessage = (event) => {
          const data = JSON.parse(event.data);
          img.src = "data:image/jpeg;base64," + data.frame;
        };

        ws.onerror = (err) => {
          console.error("WebSocket error:", err);
        };

        ws.onclose = () => {
          console.log("WebSocket closed");
          clearInterval(sendInterval);
        };
      });
    }
  </script>
</html>
